import os, sys
import csv
import getManifestData


def extractMalwareFamilyData(dataFolder,malwareFamily):
    for malwareApp in os.listdir(dataFolder+'/'+malwareFamily):
        print malwareApp.replace(".apk","")
        result = getManifestData.getAPKManifestInfo(dataFolder+'/'+malwareFamily+'/'+malwareApp)
        filename = dataFolder+'_extracted/'+'feature_vectors/' + malwareApp.replace(".apk","")
        file = open(filename,'w')
        file.writelines(result)
        file.close()

        with open(dataFolder+'_extracted/sha256_family.csv', 'a') as csvfile:
            writer = csv.writer(csvfile)
            writer.writerow([malwareApp.replace(".apk",""),malwareFamily])

def extractData(dataFolder):
    if not os.path.exists(dataFolder+'extracted'):
        os.makedirs(dataFolder+'_extracted')
        os.makedirs(dataFolder+'_extracted/'+'feature_vectors')       
    else:    
        print("extract data already exists") 
        return   
    with open(dataFolder+'_extracted/sha256_family.csv', 'wb') as csvfile:
        filewriter = csv.writer(csvfile, delimiter=',',
                            quotechar='|', quoting=csv.QUOTE_MINIMAL)
        filewriter.writerow(['sha256', 'family'])

    for malwareFamily in os.listdir(dataFolder):
        print malwareFamily
        extractMalwareFamilyData(dataFolder, malwareFamily)
    
   


extractData('samples')